<?php

declare(strict_types=1);

/**
 * ParcelsApi
 * PHP version 7.2
 *
 * @category Class
 * @package  Toppy\Sendcloud
 * @author   OpenAPI Generator team
 * @link     https://openapi-generator.tech
 */
/**
 * Sendcloud Public REST API
 *
 * Complete Sendcloud API v2 specification - merged from official sendcloud.dev documentation
 *
 * The version of the OpenAPI document: 2.0.0
 * Contact: contact@sendcloud.com
 * Generated by: https://openapi-generator.tech
 * Generator version: 7.18.0
 */
/**
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Do not edit the class manually.
 */
namespace Toppy\Sendcloud\Api;

use GuzzleHttp\Psr7\MultipartStream;
use Http\Client\Common\Plugin\ErrorPlugin;
use Http\Client\Common\Plugin\RedirectPlugin;
use Http\Client\Common\PluginClient;
use Http\Client\Common\PluginClientFactory;
use Http\Client\Exception\HttpException;
use Http\Client\HttpAsyncClient;
use Http\Discovery\HttpAsyncClientDiscovery;
use Http\Discovery\Psr17FactoryDiscovery;
use Http\Discovery\Psr18ClientDiscovery;
use Http\Message\RequestFactory;
use Http\Promise\Promise;
use Toppy\Sendcloud\ApiException;
use Toppy\Sendcloud\Configuration;
use Toppy\Sendcloud\DebugPlugin;
use Toppy\Sendcloud\HeaderSelector;
use Toppy\Sendcloud\FormDataProcessor;
use Toppy\Sendcloud\ObjectSerializer;
use Psr\Http\Client\ClientExceptionInterface;
use Psr\Http\Client\ClientInterface;
use Psr\Http\Message\RequestFactoryInterface;
use Psr\Http\Message\RequestInterface;
use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\StreamFactoryInterface;
use Psr\Http\Message\UriFactoryInterface;
use Psr\Http\Message\UriInterface;
use function sprintf;

/**
 * ParcelsApi Class Doc Comment
 *
 * @category Class
 * @package  Toppy\Sendcloud
 * @author   OpenAPI Generator team
 * @link     https://openapi-generator.tech
 */
class ParcelsApi
{
    /**
     * @var PluginClient
     */
    protected $httpClient;

    /**
     * @var PluginClient
     */
    protected $httpAsyncClient;

    /**
     * @var UriFactoryInterface
     */
    protected $uriFactory;

    /**
     * @var Configuration
     */
    protected $config;

    /**
     * @var RequestFactoryInterface
     */
    protected $requestFactory;

    /**
     * @var StreamFactoryInterface
     */
    protected $streamFactory;

    /**
     * @param int $hostIndex
     */
    public function __construct(
        ?ClientInterface $httpClient = null,
        ?Configuration $configuration = null,
        ?HttpAsyncClient $httpAsyncClient = null,
        ?UriFactoryInterface $uriFactory = null,
        ?RequestFactoryInterface $requestFactory = null,
        ?StreamFactoryInterface $streamFactory = null,
        protected ?HeaderSelector $headerSelector = new HeaderSelector(),
        ?array $plugins = null,
        /**
         * @var int Host index
         */
        protected $hostIndex = 0
    ) {
        $this->config = $configuration ?? (new Configuration())->setHost('https://panel.sendcloud.sc/api/v2');
        $this->requestFactory = $requestFactory ?? Psr17FactoryDiscovery::findRequestFactory();
        $this->streamFactory = $streamFactory ?? Psr17FactoryDiscovery::findStreamFactory();

        $plugins = $plugins ?? [
            new RedirectPlugin(['strict' => true]),
            new ErrorPlugin(),
        ];

        if ($this->config->getDebug()) {
            $plugins[] = new DebugPlugin(fopen($this->config->getDebugFile(), 'ab'));
        }

        $this->httpClient = (new PluginClientFactory())->createClient(
            $httpClient ?? Psr18ClientDiscovery::find(),
            $plugins
        );

        $this->httpAsyncClient = (new PluginClientFactory())->createClient(
            $httpAsyncClient ?? HttpAsyncClientDiscovery::find(),
            $plugins
        );

        $this->uriFactory = $uriFactory ?? Psr17FactoryDiscovery::findUriFactory();
    }

    /**
     * Set the host index
     *
     * @param int $hostIndex Host index (required)
     */
    public function setHostIndex($hostIndex): void
    {
        $this->hostIndex = $hostIndex;
    }

    /**
     * Get the host index
     *
     * @return int Host index
     */
    public function getHostIndex()
    {
        return $this->hostIndex;
    }

    /**
     * @return Configuration
     */
    public function getConfig()
    {
        return $this->config;
    }

    /**
     * Operation scPublicV2ScpGetAllParcels
     *
     * Retrieve parcels
     *
     * @param  int $parcelStatus Returns parcels that have the requested status. For a list of possible statuses, see the [Retrieve a list of parcel statuses](/api/v2/parcel-statuses/retrieve-a-list-of-parcel-statuses) endpoint. (optional)
     * @param  string $trackingNumber Returns parcels that match a specified tracking number (optional)
     * @param  string $externalReference Returns parcels that match a specified external reference (optional)
     * @param  string $orderNumber Returns an order that matches a specific &#x60;order_number&#x60; property from your parcels (optional)
     * @param  string $updatedAfter Returns all orders which have been updated in our system after a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedAfter Returns all orders which have been announced to the carrier after the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $ids Filter results using a list of Parcel IDs. This is a comma separated list of IDs, it may not contain more then 100 IDs. (optional)
     * @param  string $cursor Next and previous token that is used to paginate. The token is included in the response. (optional)
     * @param  string $errors If you are using this API for development purposes, you might want to use the errors query string in the URL. This allows you to visualize errors from the carrier. (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return \Toppy\Sendcloud\Model\ScPublicV2ScpGetAllParcels200Response|\Toppy\Sendcloud\Model\ScPublicV2OrdersPostDeleteAShipment400Response
     */
    public function scPublicV2ScpGetAllParcels($parcelStatus = null, $trackingNumber = null, $externalReference = null, $orderNumber = null, $updatedAfter = null, $announcedAfter = null, $ids = null, $cursor = null, $errors = null)
    {
        [$response] = $this->scPublicV2ScpGetAllParcelsWithHttpInfo($parcelStatus, $trackingNumber, $externalReference, $orderNumber, $updatedAfter, $announcedAfter, $ids, $cursor, $errors);
        return $response;
    }

    /**
     * Operation scPublicV2ScpGetAllParcelsWithHttpInfo
     *
     * Retrieve parcels
     *
     * @param  int $parcelStatus Returns parcels that have the requested status. For a list of possible statuses, see the [Retrieve a list of parcel statuses](/api/v2/parcel-statuses/retrieve-a-list-of-parcel-statuses) endpoint. (optional)
     * @param  string $trackingNumber Returns parcels that match a specified tracking number (optional)
     * @param  string $externalReference Returns parcels that match a specified external reference (optional)
     * @param  string $orderNumber Returns an order that matches a specific &#x60;order_number&#x60; property from your parcels (optional)
     * @param  string $updatedAfter Returns all orders which have been updated in our system after a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedAfter Returns all orders which have been announced to the carrier after the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $ids Filter results using a list of Parcel IDs. This is a comma separated list of IDs, it may not contain more then 100 IDs. (optional)
     * @param  string $cursor Next and previous token that is used to paginate. The token is included in the response. (optional)
     * @param  string $errors If you are using this API for development purposes, you might want to use the errors query string in the URL. This allows you to visualize errors from the carrier. (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return array of \Toppy\Sendcloud\Model\ScPublicV2ScpGetAllParcels200Response|\Toppy\Sendcloud\Model\ScPublicV2OrdersPostDeleteAShipment400Response, HTTP status code, HTTP response headers (array of strings)
     */
    public function scPublicV2ScpGetAllParcelsWithHttpInfo($parcelStatus = null, $trackingNumber = null, $externalReference = null, $orderNumber = null, $updatedAfter = null, $announcedAfter = null, $ids = null, $cursor = null, $errors = null)
    {
        $request = $this->scPublicV2ScpGetAllParcelsRequest($parcelStatus, $trackingNumber, $externalReference, $orderNumber, $updatedAfter, $announcedAfter, $ids, $cursor, $errors);

        try {
            try {
                $response = $this->httpClient->sendRequest($request);
            } catch (HttpException $e) {
                $response = $e->getResponse();
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $response->getStatusCode(),
                        (string) $request->getUri()
                    ),
                    $request,
                    $response,
                    $e
                );
            } catch (ClientExceptionInterface $e) {
                throw new ApiException(
                    sprintf('[%d] %s', $e->getCode(), $e->getMessage()),
                    $request,
                    null,
                    $e
                );
            }

            $statusCode = $response->getStatusCode();


            switch($statusCode) {
                case 200:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\ScPublicV2ScpGetAllParcels200Response::class,
                        $request,
                        $response,
                    );
                case 404:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\ScPublicV2OrdersPostDeleteAShipment400Response::class,
                        $request,
                        $response,
                    );
            }

            

            if ($statusCode < 200 || $statusCode > 299) {
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $statusCode,
                        (string) $request->getUri()
                    ),
                    $request,
                    $response
                );
            }

            return $this->handleResponseWithDataType(
                \Toppy\Sendcloud\Model\ScPublicV2ScpGetAllParcels200Response::class,
                $request,
                $response,
            );
        } catch (ApiException $apiException) {
            switch ($apiException->getCode()) {
                case 200:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\ScPublicV2ScpGetAllParcels200Response::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 404:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\ScPublicV2OrdersPostDeleteAShipment400Response::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
            }
        

            throw $apiException;
        }
    }

    /**
     * Operation scPublicV2ScpGetAllParcelsAsync
     *
     * Retrieve parcels
     *
     * @param  int $parcelStatus Returns parcels that have the requested status. For a list of possible statuses, see the [Retrieve a list of parcel statuses](/api/v2/parcel-statuses/retrieve-a-list-of-parcel-statuses) endpoint. (optional)
     * @param  string $trackingNumber Returns parcels that match a specified tracking number (optional)
     * @param  string $externalReference Returns parcels that match a specified external reference (optional)
     * @param  string $orderNumber Returns an order that matches a specific &#x60;order_number&#x60; property from your parcels (optional)
     * @param  string $updatedAfter Returns all orders which have been updated in our system after a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedAfter Returns all orders which have been announced to the carrier after the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $ids Filter results using a list of Parcel IDs. This is a comma separated list of IDs, it may not contain more then 100 IDs. (optional)
     * @param  string $cursor Next and previous token that is used to paginate. The token is included in the response. (optional)
     * @param  string $errors If you are using this API for development purposes, you might want to use the errors query string in the URL. This allows you to visualize errors from the carrier. (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV2ScpGetAllParcelsAsync($parcelStatus = null, $trackingNumber = null, $externalReference = null, $orderNumber = null, $updatedAfter = null, $announcedAfter = null, $ids = null, $cursor = null, $errors = null)
    {
        return $this->scPublicV2ScpGetAllParcelsAsyncWithHttpInfo($parcelStatus, $trackingNumber, $externalReference, $orderNumber, $updatedAfter, $announcedAfter, $ids, $cursor, $errors)
            ->then(
                function ($response) {
                    return $response[0];
                }
            );
    }

    /**
     * Operation scPublicV2ScpGetAllParcelsAsyncWithHttpInfo
     *
     * Retrieve parcels
     *
     * @param  int $parcelStatus Returns parcels that have the requested status. For a list of possible statuses, see the [Retrieve a list of parcel statuses](/api/v2/parcel-statuses/retrieve-a-list-of-parcel-statuses) endpoint. (optional)
     * @param  string $trackingNumber Returns parcels that match a specified tracking number (optional)
     * @param  string $externalReference Returns parcels that match a specified external reference (optional)
     * @param  string $orderNumber Returns an order that matches a specific &#x60;order_number&#x60; property from your parcels (optional)
     * @param  string $updatedAfter Returns all orders which have been updated in our system after a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedAfter Returns all orders which have been announced to the carrier after the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $ids Filter results using a list of Parcel IDs. This is a comma separated list of IDs, it may not contain more then 100 IDs. (optional)
     * @param  string $cursor Next and previous token that is used to paginate. The token is included in the response. (optional)
     * @param  string $errors If you are using this API for development purposes, you might want to use the errors query string in the URL. This allows you to visualize errors from the carrier. (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV2ScpGetAllParcelsAsyncWithHttpInfo($parcelStatus = null, $trackingNumber = null, $externalReference = null, $orderNumber = null, $updatedAfter = null, $announcedAfter = null, $ids = null, $cursor = null, $errors = null)
    {
        $returnType = \Toppy\Sendcloud\Model\ScPublicV2ScpGetAllParcels200Response::class;
        $request = $this->scPublicV2ScpGetAllParcelsRequest($parcelStatus, $trackingNumber, $externalReference, $orderNumber, $updatedAfter, $announcedAfter, $ids, $cursor, $errors);

        return $this->httpAsyncClient->sendAsyncRequest($request)
            ->then(
                function ($response) use ($returnType) {
                    if ($returnType === '\SplFileObject') {
                        $content = $response->getBody(); //stream goes to serializer
                    } else {
                        $content = (string) $response->getBody();
                    }

                    return [
                        ObjectSerializer::deserialize($content, $returnType, []),
                        $response->getStatusCode(),
                        $response->getHeaders()
                    ];
                },
                function (HttpException $httpException) {
                    $response = $httpException->getResponse();
                    $statusCode = $response->getStatusCode();
                    throw new ApiException(
                        sprintf(
                            '[%d] Error connecting to the API (%s)',
                            $statusCode,
                            $httpException->getRequest()->getUri()
                        ),
                        $httpException->getRequest(),
                        $httpException->getResponse(),
                        $httpException
                    );
                }
            );
    }

    /**
     * Create request for operation 'scPublicV2ScpGetAllParcels'
     *
     * @param  int $parcelStatus Returns parcels that have the requested status. For a list of possible statuses, see the [Retrieve a list of parcel statuses](/api/v2/parcel-statuses/retrieve-a-list-of-parcel-statuses) endpoint. (optional)
     * @param  string $trackingNumber Returns parcels that match a specified tracking number (optional)
     * @param  string $externalReference Returns parcels that match a specified external reference (optional)
     * @param  string $orderNumber Returns an order that matches a specific &#x60;order_number&#x60; property from your parcels (optional)
     * @param  string $updatedAfter Returns all orders which have been updated in our system after a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedAfter Returns all orders which have been announced to the carrier after the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $ids Filter results using a list of Parcel IDs. This is a comma separated list of IDs, it may not contain more then 100 IDs. (optional)
     * @param  string $cursor Next and previous token that is used to paginate. The token is included in the response. (optional)
     * @param  string $errors If you are using this API for development purposes, you might want to use the errors query string in the URL. This allows you to visualize errors from the carrier. (optional)
     *
     * @throws \InvalidArgumentException
     * @return RequestInterface
     */
    public function scPublicV2ScpGetAllParcelsRequest($parcelStatus = null, $trackingNumber = null, $externalReference = null, $orderNumber = null, $updatedAfter = null, $announcedAfter = null, $ids = null, $cursor = null, $errors = null)
    {

        $resourcePath = '/parcels';
        $formParams = [];
        $queryParams = [];
        $headerParams = [];
        $httpBody = null;
        $multipart = false;

        // query params
        if ($parcelStatus !== null) {
            if(is_array($parcelStatus)) {
                foreach($parcelStatus as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['parcel_status'] = $parcelStatus;
            }
        }

        // query params
        if ($trackingNumber !== null) {
            if(is_array($trackingNumber)) {
                foreach($trackingNumber as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['tracking_number'] = $trackingNumber;
            }
        }

        // query params
        if ($externalReference !== null) {
            if(is_array($externalReference)) {
                foreach($externalReference as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['external_reference'] = $externalReference;
            }
        }

        // query params
        if ($orderNumber !== null) {
            if(is_array($orderNumber)) {
                foreach($orderNumber as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['order_number'] = $orderNumber;
            }
        }

        // query params
        if ($updatedAfter !== null) {
            if(is_array($updatedAfter)) {
                foreach($updatedAfter as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['updated_after'] = $updatedAfter;
            }
        }

        // query params
        if ($announcedAfter !== null) {
            if(is_array($announcedAfter)) {
                foreach($announcedAfter as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['announced_after'] = $announcedAfter;
            }
        }

        // query params
        if ($ids !== null) {
            if(is_array($ids)) {
                foreach($ids as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['ids'] = $ids;
            }
        }

        // query params
        if ($cursor !== null) {
            if(is_array($cursor)) {
                foreach($cursor as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['cursor'] = $cursor;
            }
        }

        // query params
        if ($errors !== null) {
            if(is_array($errors)) {
                foreach($errors as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['errors'] = $errors;
            }
        }




        $headers = $this->headerSelector->selectHeaders(
            ['application/json'],
            '',
            $multipart
        );

        // for model (json/xml)
        if ($formParams !== []) {
            if ($multipart) {
                $multipartContents = [];
                foreach ($formParams as $formParamName => $formParamValue) {
                    $formParamValueItems = is_array($formParamValue) ? $formParamValue : [$formParamValue];
                    foreach ($formParamValueItems as $formParamValueItem) {
                        $multipartContents[] = [
                            'name' => $formParamName,
                            'contents' => $formParamValueItem
                        ];
                    }
                }

                // for HTTP post (form)
                $httpBody = new MultipartStream($multipartContents);

            } elseif ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode($formParams);

            } else {
                // for HTTP post (form)
                $httpBody = ObjectSerializer::buildQuery($formParams);
            }
        }

        // this endpoint requires HTTP basic authentication
        if (!empty($this->config->getUsername()) || !(empty($this->config->getPassword()))) {
            $headers['Authorization'] = 'Basic ' . base64_encode($this->config->getUsername() . ":" . $this->config->getPassword());
        }

        $defaultHeaders = [];
        if ($this->config->getUserAgent()) {
            $defaultHeaders['User-Agent'] = $this->config->getUserAgent();
        }

        $headers = array_merge(
            $defaultHeaders,
            $headerParams,
            $headers
        );

        $operationHost = $this->config->getHost();

        $uri = $this->createUri($operationHost, $resourcePath, $queryParams);

        return $this->createRequest('GET', $uri, $headers, $httpBody);
    }

    /**
     * Operation scPublicV2ScpGetParcelById
     *
     * Retrieve a parcel
     *
     * @param  int $id The id of the parcel you want to retrieve (required)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return \Toppy\Sendcloud\Model\ScPublicV2ScpGetParcelById200Response
     */
    public function scPublicV2ScpGetParcelById($id)
    {
        [$response] = $this->scPublicV2ScpGetParcelByIdWithHttpInfo($id);
        return $response;
    }

    /**
     * Operation scPublicV2ScpGetParcelByIdWithHttpInfo
     *
     * Retrieve a parcel
     *
     * @param  int $id The id of the parcel you want to retrieve (required)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return array of \Toppy\Sendcloud\Model\ScPublicV2ScpGetParcelById200Response, HTTP status code, HTTP response headers (array of strings)
     */
    public function scPublicV2ScpGetParcelByIdWithHttpInfo($id)
    {
        $request = $this->scPublicV2ScpGetParcelByIdRequest($id);

        try {
            try {
                $response = $this->httpClient->sendRequest($request);
            } catch (HttpException $e) {
                $response = $e->getResponse();
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $response->getStatusCode(),
                        (string) $request->getUri()
                    ),
                    $request,
                    $response,
                    $e
                );
            } catch (ClientExceptionInterface $e) {
                throw new ApiException(
                    sprintf('[%d] %s', $e->getCode(), $e->getMessage()),
                    $request,
                    null,
                    $e
                );
            }

            $statusCode = $response->getStatusCode();


            if ($statusCode === 200) {
                return $this->handleResponseWithDataType(
                    \Toppy\Sendcloud\Model\ScPublicV2ScpGetParcelById200Response::class,
                    $request,
                    $response,
                );
            }

            

            if ($statusCode < 200 || $statusCode > 299) {
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $statusCode,
                        (string) $request->getUri()
                    ),
                    $request,
                    $response
                );
            }

            return $this->handleResponseWithDataType(
                \Toppy\Sendcloud\Model\ScPublicV2ScpGetParcelById200Response::class,
                $request,
                $response,
            );
        } catch (ApiException $apiException) {
            if ($apiException->getCode() === 200) {
                $data = ObjectSerializer::deserialize(
                    $apiException->getResponseBody(),
                    \Toppy\Sendcloud\Model\ScPublicV2ScpGetParcelById200Response::class,
                    $apiException->getResponseHeaders()
                );
                $apiException->setResponseObject($data);
                throw $apiException;
            }
        

            throw $apiException;
        }
    }

    /**
     * Operation scPublicV2ScpGetParcelByIdAsync
     *
     * Retrieve a parcel
     *
     * @param  int $id The id of the parcel you want to retrieve (required)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV2ScpGetParcelByIdAsync($id)
    {
        return $this->scPublicV2ScpGetParcelByIdAsyncWithHttpInfo($id)
            ->then(
                function ($response) {
                    return $response[0];
                }
            );
    }

    /**
     * Operation scPublicV2ScpGetParcelByIdAsyncWithHttpInfo
     *
     * Retrieve a parcel
     *
     * @param  int $id The id of the parcel you want to retrieve (required)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV2ScpGetParcelByIdAsyncWithHttpInfo($id)
    {
        $returnType = \Toppy\Sendcloud\Model\ScPublicV2ScpGetParcelById200Response::class;
        $request = $this->scPublicV2ScpGetParcelByIdRequest($id);

        return $this->httpAsyncClient->sendAsyncRequest($request)
            ->then(
                function ($response) use ($returnType) {
                    if ($returnType === '\SplFileObject') {
                        $content = $response->getBody(); //stream goes to serializer
                    } else {
                        $content = (string) $response->getBody();
                    }

                    return [
                        ObjectSerializer::deserialize($content, $returnType, []),
                        $response->getStatusCode(),
                        $response->getHeaders()
                    ];
                },
                function (HttpException $httpException) {
                    $response = $httpException->getResponse();
                    $statusCode = $response->getStatusCode();
                    throw new ApiException(
                        sprintf(
                            '[%d] Error connecting to the API (%s)',
                            $statusCode,
                            $httpException->getRequest()->getUri()
                        ),
                        $httpException->getRequest(),
                        $httpException->getResponse(),
                        $httpException
                    );
                }
            );
    }

    /**
     * Create request for operation 'scPublicV2ScpGetParcelById'
     *
     * @param  int $id The id of the parcel you want to retrieve (required)
     *
     * @throws \InvalidArgumentException
     * @return RequestInterface
     */
    public function scPublicV2ScpGetParcelByIdRequest($id)
    {
        // verify the required parameter 'id' is set
        if ($id === null || (is_array($id) && $id === [])) {
            throw new \InvalidArgumentException(
                'Missing the required parameter $id when calling scPublicV2ScpGetParcelById'
            );
        }

        $resourcePath = '/parcels/{id}';
        $formParams = [];
        $queryParams = [];
        $headerParams = [];
        $httpBody = null;
        $multipart = false;



        // path params
        $resourcePath = str_replace(
            '{id}',
            ObjectSerializer::toPathValue($id),
            $resourcePath
        );


        $headers = $this->headerSelector->selectHeaders(
            ['application/json'],
            '',
            $multipart
        );

        // for model (json/xml)
        if ($formParams !== []) {
            if ($multipart) {
                $multipartContents = [];
                foreach ($formParams as $formParamName => $formParamValue) {
                    $formParamValueItems = is_array($formParamValue) ? $formParamValue : [$formParamValue];
                    foreach ($formParamValueItems as $formParamValueItem) {
                        $multipartContents[] = [
                            'name' => $formParamName,
                            'contents' => $formParamValueItem
                        ];
                    }
                }

                // for HTTP post (form)
                $httpBody = new MultipartStream($multipartContents);

            } elseif ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode($formParams);

            } else {
                // for HTTP post (form)
                $httpBody = ObjectSerializer::buildQuery($formParams);
            }
        }

        // this endpoint requires HTTP basic authentication
        if (!empty($this->config->getUsername()) || !(empty($this->config->getPassword()))) {
            $headers['Authorization'] = 'Basic ' . base64_encode($this->config->getUsername() . ":" . $this->config->getPassword());
        }

        $defaultHeaders = [];
        if ($this->config->getUserAgent()) {
            $defaultHeaders['User-Agent'] = $this->config->getUserAgent();
        }

        $headers = array_merge(
            $defaultHeaders,
            $headerParams,
            $headers
        );

        $operationHost = $this->config->getHost();

        $uri = $this->createUri($operationHost, $resourcePath, $queryParams);

        return $this->createRequest('GET', $uri, $headers, $httpBody);
    }

    /**
     * Operation scPublicV2ScpGetReturnPortalUrl
     *
     * Retrieve a return portal URL
     *
     * @param  string $id ID of the parcel (required)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return \Toppy\Sendcloud\Model\ScPublicV2ScpGetReturnPortalUrl200Response
     */
    public function scPublicV2ScpGetReturnPortalUrl($id)
    {
        [$response] = $this->scPublicV2ScpGetReturnPortalUrlWithHttpInfo($id);
        return $response;
    }

    /**
     * Operation scPublicV2ScpGetReturnPortalUrlWithHttpInfo
     *
     * Retrieve a return portal URL
     *
     * @param  string $id ID of the parcel (required)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return array of \Toppy\Sendcloud\Model\ScPublicV2ScpGetReturnPortalUrl200Response, HTTP status code, HTTP response headers (array of strings)
     */
    public function scPublicV2ScpGetReturnPortalUrlWithHttpInfo($id)
    {
        $request = $this->scPublicV2ScpGetReturnPortalUrlRequest($id);

        try {
            try {
                $response = $this->httpClient->sendRequest($request);
            } catch (HttpException $e) {
                $response = $e->getResponse();
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $response->getStatusCode(),
                        (string) $request->getUri()
                    ),
                    $request,
                    $response,
                    $e
                );
            } catch (ClientExceptionInterface $e) {
                throw new ApiException(
                    sprintf('[%d] %s', $e->getCode(), $e->getMessage()),
                    $request,
                    null,
                    $e
                );
            }

            $statusCode = $response->getStatusCode();


            if ($statusCode === 200) {
                return $this->handleResponseWithDataType(
                    \Toppy\Sendcloud\Model\ScPublicV2ScpGetReturnPortalUrl200Response::class,
                    $request,
                    $response,
                );
            }

            

            if ($statusCode < 200 || $statusCode > 299) {
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $statusCode,
                        (string) $request->getUri()
                    ),
                    $request,
                    $response
                );
            }

            return $this->handleResponseWithDataType(
                \Toppy\Sendcloud\Model\ScPublicV2ScpGetReturnPortalUrl200Response::class,
                $request,
                $response,
            );
        } catch (ApiException $apiException) {
            if ($apiException->getCode() === 200) {
                $data = ObjectSerializer::deserialize(
                    $apiException->getResponseBody(),
                    \Toppy\Sendcloud\Model\ScPublicV2ScpGetReturnPortalUrl200Response::class,
                    $apiException->getResponseHeaders()
                );
                $apiException->setResponseObject($data);
                throw $apiException;
            }
        

            throw $apiException;
        }
    }

    /**
     * Operation scPublicV2ScpGetReturnPortalUrlAsync
     *
     * Retrieve a return portal URL
     *
     * @param  string $id ID of the parcel (required)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV2ScpGetReturnPortalUrlAsync($id)
    {
        return $this->scPublicV2ScpGetReturnPortalUrlAsyncWithHttpInfo($id)
            ->then(
                function ($response) {
                    return $response[0];
                }
            );
    }

    /**
     * Operation scPublicV2ScpGetReturnPortalUrlAsyncWithHttpInfo
     *
     * Retrieve a return portal URL
     *
     * @param  string $id ID of the parcel (required)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV2ScpGetReturnPortalUrlAsyncWithHttpInfo($id)
    {
        $returnType = \Toppy\Sendcloud\Model\ScPublicV2ScpGetReturnPortalUrl200Response::class;
        $request = $this->scPublicV2ScpGetReturnPortalUrlRequest($id);

        return $this->httpAsyncClient->sendAsyncRequest($request)
            ->then(
                function ($response) use ($returnType) {
                    if ($returnType === '\SplFileObject') {
                        $content = $response->getBody(); //stream goes to serializer
                    } else {
                        $content = (string) $response->getBody();
                    }

                    return [
                        ObjectSerializer::deserialize($content, $returnType, []),
                        $response->getStatusCode(),
                        $response->getHeaders()
                    ];
                },
                function (HttpException $httpException) {
                    $response = $httpException->getResponse();
                    $statusCode = $response->getStatusCode();
                    throw new ApiException(
                        sprintf(
                            '[%d] Error connecting to the API (%s)',
                            $statusCode,
                            $httpException->getRequest()->getUri()
                        ),
                        $httpException->getRequest(),
                        $httpException->getResponse(),
                        $httpException
                    );
                }
            );
    }

    /**
     * Create request for operation 'scPublicV2ScpGetReturnPortalUrl'
     *
     * @param  string $id ID of the parcel (required)
     *
     * @throws \InvalidArgumentException
     * @return RequestInterface
     */
    public function scPublicV2ScpGetReturnPortalUrlRequest($id)
    {
        // verify the required parameter 'id' is set
        if ($id === null || (is_array($id) && $id === [])) {
            throw new \InvalidArgumentException(
                'Missing the required parameter $id when calling scPublicV2ScpGetReturnPortalUrl'
            );
        }

        $resourcePath = '/parcels/{id}/return_portal_url';
        $formParams = [];
        $queryParams = [];
        $headerParams = [];
        $httpBody = null;
        $multipart = false;



        // path params
        $resourcePath = str_replace(
            '{id}',
            ObjectSerializer::toPathValue($id),
            $resourcePath
        );


        $headers = $this->headerSelector->selectHeaders(
            ['application/json'],
            '',
            $multipart
        );

        // for model (json/xml)
        if ($formParams !== []) {
            if ($multipart) {
                $multipartContents = [];
                foreach ($formParams as $formParamName => $formParamValue) {
                    $formParamValueItems = is_array($formParamValue) ? $formParamValue : [$formParamValue];
                    foreach ($formParamValueItems as $formParamValueItem) {
                        $multipartContents[] = [
                            'name' => $formParamName,
                            'contents' => $formParamValueItem
                        ];
                    }
                }

                // for HTTP post (form)
                $httpBody = new MultipartStream($multipartContents);

            } elseif ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode($formParams);

            } else {
                // for HTTP post (form)
                $httpBody = ObjectSerializer::buildQuery($formParams);
            }
        }

        // this endpoint requires HTTP basic authentication
        if (!empty($this->config->getUsername()) || !(empty($this->config->getPassword()))) {
            $headers['Authorization'] = 'Basic ' . base64_encode($this->config->getUsername() . ":" . $this->config->getPassword());
        }

        $defaultHeaders = [];
        if ($this->config->getUserAgent()) {
            $defaultHeaders['User-Agent'] = $this->config->getUserAgent();
        }

        $headers = array_merge(
            $defaultHeaders,
            $headerParams,
            $headers
        );

        $operationHost = $this->config->getHost();

        $uri = $this->createUri($operationHost, $resourcePath, $queryParams);

        return $this->createRequest('GET', $uri, $headers, $httpBody);
    }

    /**
     * Operation scPublicV2ScpPostCancelSpecific
     *
     * Cancel a parcel
     *
     * @param  string $id ID of the parcel (required)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return \Toppy\Sendcloud\Model\CancelParcelStatus
     */
    public function scPublicV2ScpPostCancelSpecific($id)
    {
        [$response] = $this->scPublicV2ScpPostCancelSpecificWithHttpInfo($id);
        return $response;
    }

    /**
     * Operation scPublicV2ScpPostCancelSpecificWithHttpInfo
     *
     * Cancel a parcel
     *
     * @param  string $id ID of the parcel (required)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return array of \Toppy\Sendcloud\Model\CancelParcelStatus, HTTP status code, HTTP response headers (array of strings)
     */
    public function scPublicV2ScpPostCancelSpecificWithHttpInfo($id)
    {
        $request = $this->scPublicV2ScpPostCancelSpecificRequest($id);

        try {
            try {
                $response = $this->httpClient->sendRequest($request);
            } catch (HttpException $e) {
                $response = $e->getResponse();
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $response->getStatusCode(),
                        (string) $request->getUri()
                    ),
                    $request,
                    $response,
                    $e
                );
            } catch (ClientExceptionInterface $e) {
                throw new ApiException(
                    sprintf('[%d] %s', $e->getCode(), $e->getMessage()),
                    $request,
                    null,
                    $e
                );
            }

            $statusCode = $response->getStatusCode();


            if ($statusCode === 200) {
                return $this->handleResponseWithDataType(
                    \Toppy\Sendcloud\Model\CancelParcelStatus::class,
                    $request,
                    $response,
                );
            }

            

            if ($statusCode < 200 || $statusCode > 299) {
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $statusCode,
                        (string) $request->getUri()
                    ),
                    $request,
                    $response
                );
            }

            return $this->handleResponseWithDataType(
                \Toppy\Sendcloud\Model\CancelParcelStatus::class,
                $request,
                $response,
            );
        } catch (ApiException $apiException) {
            if ($apiException->getCode() === 200) {
                $data = ObjectSerializer::deserialize(
                    $apiException->getResponseBody(),
                    \Toppy\Sendcloud\Model\CancelParcelStatus::class,
                    $apiException->getResponseHeaders()
                );
                $apiException->setResponseObject($data);
                throw $apiException;
            }
        

            throw $apiException;
        }
    }

    /**
     * Operation scPublicV2ScpPostCancelSpecificAsync
     *
     * Cancel a parcel
     *
     * @param  string $id ID of the parcel (required)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV2ScpPostCancelSpecificAsync($id)
    {
        return $this->scPublicV2ScpPostCancelSpecificAsyncWithHttpInfo($id)
            ->then(
                function ($response) {
                    return $response[0];
                }
            );
    }

    /**
     * Operation scPublicV2ScpPostCancelSpecificAsyncWithHttpInfo
     *
     * Cancel a parcel
     *
     * @param  string $id ID of the parcel (required)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV2ScpPostCancelSpecificAsyncWithHttpInfo($id)
    {
        $returnType = \Toppy\Sendcloud\Model\CancelParcelStatus::class;
        $request = $this->scPublicV2ScpPostCancelSpecificRequest($id);

        return $this->httpAsyncClient->sendAsyncRequest($request)
            ->then(
                function ($response) use ($returnType) {
                    if ($returnType === '\SplFileObject') {
                        $content = $response->getBody(); //stream goes to serializer
                    } else {
                        $content = (string) $response->getBody();
                    }

                    return [
                        ObjectSerializer::deserialize($content, $returnType, []),
                        $response->getStatusCode(),
                        $response->getHeaders()
                    ];
                },
                function (HttpException $httpException) {
                    $response = $httpException->getResponse();
                    $statusCode = $response->getStatusCode();
                    throw new ApiException(
                        sprintf(
                            '[%d] Error connecting to the API (%s)',
                            $statusCode,
                            $httpException->getRequest()->getUri()
                        ),
                        $httpException->getRequest(),
                        $httpException->getResponse(),
                        $httpException
                    );
                }
            );
    }

    /**
     * Create request for operation 'scPublicV2ScpPostCancelSpecific'
     *
     * @param  string $id ID of the parcel (required)
     *
     * @throws \InvalidArgumentException
     * @return RequestInterface
     */
    public function scPublicV2ScpPostCancelSpecificRequest($id)
    {
        // verify the required parameter 'id' is set
        if ($id === null || (is_array($id) && $id === [])) {
            throw new \InvalidArgumentException(
                'Missing the required parameter $id when calling scPublicV2ScpPostCancelSpecific'
            );
        }

        $resourcePath = '/parcels/{id}/cancel';
        $formParams = [];
        $queryParams = [];
        $headerParams = [];
        $httpBody = null;
        $multipart = false;



        // path params
        $resourcePath = str_replace(
            '{id}',
            ObjectSerializer::toPathValue($id),
            $resourcePath
        );


        $headers = $this->headerSelector->selectHeaders(
            ['application/json'],
            '',
            $multipart
        );

        // for model (json/xml)
        if ($formParams !== []) {
            if ($multipart) {
                $multipartContents = [];
                foreach ($formParams as $formParamName => $formParamValue) {
                    $formParamValueItems = is_array($formParamValue) ? $formParamValue : [$formParamValue];
                    foreach ($formParamValueItems as $formParamValueItem) {
                        $multipartContents[] = [
                            'name' => $formParamName,
                            'contents' => $formParamValueItem
                        ];
                    }
                }

                // for HTTP post (form)
                $httpBody = new MultipartStream($multipartContents);

            } elseif ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode($formParams);

            } else {
                // for HTTP post (form)
                $httpBody = ObjectSerializer::buildQuery($formParams);
            }
        }

        // this endpoint requires HTTP basic authentication
        if (!empty($this->config->getUsername()) || !(empty($this->config->getPassword()))) {
            $headers['Authorization'] = 'Basic ' . base64_encode($this->config->getUsername() . ":" . $this->config->getPassword());
        }

        $defaultHeaders = [];
        if ($this->config->getUserAgent()) {
            $defaultHeaders['User-Agent'] = $this->config->getUserAgent();
        }

        $headers = array_merge(
            $defaultHeaders,
            $headerParams,
            $headers
        );

        $operationHost = $this->config->getHost();

        $uri = $this->createUri($operationHost, $resourcePath, $queryParams);

        return $this->createRequest('POST', $uri, $headers, $httpBody);
    }

    /**
     * Operation scPublicV2ScpPostCreateParcel
     *
     * Create a parcel or parcels
     *
     * @param  string $sendcloudPartnerId If you are an official [Sendcloud Tech Partner](https://www.sendcloud.com/ecosystem/), send your unique Sendcloud Partner UUID as a request header for the system to recognize you.  The header is not required but if it is set, the system will check it. An unknown or invalid UUID will cause a 400 error. (optional)
     * @param  string $errors When making an API request, the errors query parameter can be used to determine the type of errors that should be included in the response. If &#x60;verbose&#x60; is specified, the response will only contain errors that Sendcloud has validated. These errors may include shipment details such as invalid addresses or missing postal codes. On the other hand, if &#x60;verbose-carrier&#x60; is specified, the response will include errors originating from the carriers side of the shipping process. These errors may result from technical or validation problems, such as connection failures or issues with the carrier&#x60;s systems, that prevent the shipment from being processed. More details are described on the page [Handling parcel errors](/docs/shipping/handling-parcel-errors). (optional)
     * @param  \Toppy\Sendcloud\Model\ScPublicV2ScpPostCreateParcelRequest $scPublicV2ScpPostCreateParcelRequest scPublicV2ScpPostCreateParcelRequest (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return \Toppy\Sendcloud\Model\ScPublicV2ScpPostCreateParcel200Response|\Toppy\Sendcloud\Model\CreateParcelError
     */
    public function scPublicV2ScpPostCreateParcel($sendcloudPartnerId = null, $errors = null, $scPublicV2ScpPostCreateParcelRequest = null)
    {
        [$response] = $this->scPublicV2ScpPostCreateParcelWithHttpInfo($sendcloudPartnerId, $errors, $scPublicV2ScpPostCreateParcelRequest);
        return $response;
    }

    /**
     * Operation scPublicV2ScpPostCreateParcelWithHttpInfo
     *
     * Create a parcel or parcels
     *
     * @param  string $sendcloudPartnerId If you are an official [Sendcloud Tech Partner](https://www.sendcloud.com/ecosystem/), send your unique Sendcloud Partner UUID as a request header for the system to recognize you.  The header is not required but if it is set, the system will check it. An unknown or invalid UUID will cause a 400 error. (optional)
     * @param  string $errors When making an API request, the errors query parameter can be used to determine the type of errors that should be included in the response. If &#x60;verbose&#x60; is specified, the response will only contain errors that Sendcloud has validated. These errors may include shipment details such as invalid addresses or missing postal codes. On the other hand, if &#x60;verbose-carrier&#x60; is specified, the response will include errors originating from the carriers side of the shipping process. These errors may result from technical or validation problems, such as connection failures or issues with the carrier&#x60;s systems, that prevent the shipment from being processed. More details are described on the page [Handling parcel errors](/docs/shipping/handling-parcel-errors). (optional)
     * @param  \Toppy\Sendcloud\Model\ScPublicV2ScpPostCreateParcelRequest $scPublicV2ScpPostCreateParcelRequest (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return array of \Toppy\Sendcloud\Model\ScPublicV2ScpPostCreateParcel200Response|\Toppy\Sendcloud\Model\CreateParcelError, HTTP status code, HTTP response headers (array of strings)
     */
    public function scPublicV2ScpPostCreateParcelWithHttpInfo($sendcloudPartnerId = null, $errors = null, $scPublicV2ScpPostCreateParcelRequest = null)
    {
        $request = $this->scPublicV2ScpPostCreateParcelRequest($sendcloudPartnerId, $errors, $scPublicV2ScpPostCreateParcelRequest);

        try {
            try {
                $response = $this->httpClient->sendRequest($request);
            } catch (HttpException $e) {
                $response = $e->getResponse();
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $response->getStatusCode(),
                        (string) $request->getUri()
                    ),
                    $request,
                    $response,
                    $e
                );
            } catch (ClientExceptionInterface $e) {
                throw new ApiException(
                    sprintf('[%d] %s', $e->getCode(), $e->getMessage()),
                    $request,
                    null,
                    $e
                );
            }

            $statusCode = $response->getStatusCode();


            switch($statusCode) {
                case 200:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\ScPublicV2ScpPostCreateParcel200Response::class,
                        $request,
                        $response,
                    );
                case 400:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\CreateParcelError::class,
                        $request,
                        $response,
                    );
            }

            

            if ($statusCode < 200 || $statusCode > 299) {
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $statusCode,
                        (string) $request->getUri()
                    ),
                    $request,
                    $response
                );
            }

            return $this->handleResponseWithDataType(
                \Toppy\Sendcloud\Model\ScPublicV2ScpPostCreateParcel200Response::class,
                $request,
                $response,
            );
        } catch (ApiException $apiException) {
            switch ($apiException->getCode()) {
                case 200:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\ScPublicV2ScpPostCreateParcel200Response::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 400:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\CreateParcelError::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
            }
        

            throw $apiException;
        }
    }

    /**
     * Operation scPublicV2ScpPostCreateParcelAsync
     *
     * Create a parcel or parcels
     *
     * @param  string $sendcloudPartnerId If you are an official [Sendcloud Tech Partner](https://www.sendcloud.com/ecosystem/), send your unique Sendcloud Partner UUID as a request header for the system to recognize you.  The header is not required but if it is set, the system will check it. An unknown or invalid UUID will cause a 400 error. (optional)
     * @param  string $errors When making an API request, the errors query parameter can be used to determine the type of errors that should be included in the response. If &#x60;verbose&#x60; is specified, the response will only contain errors that Sendcloud has validated. These errors may include shipment details such as invalid addresses or missing postal codes. On the other hand, if &#x60;verbose-carrier&#x60; is specified, the response will include errors originating from the carriers side of the shipping process. These errors may result from technical or validation problems, such as connection failures or issues with the carrier&#x60;s systems, that prevent the shipment from being processed. More details are described on the page [Handling parcel errors](/docs/shipping/handling-parcel-errors). (optional)
     * @param  \Toppy\Sendcloud\Model\ScPublicV2ScpPostCreateParcelRequest $scPublicV2ScpPostCreateParcelRequest (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV2ScpPostCreateParcelAsync($sendcloudPartnerId = null, $errors = null, $scPublicV2ScpPostCreateParcelRequest = null)
    {
        return $this->scPublicV2ScpPostCreateParcelAsyncWithHttpInfo($sendcloudPartnerId, $errors, $scPublicV2ScpPostCreateParcelRequest)
            ->then(
                function ($response) {
                    return $response[0];
                }
            );
    }

    /**
     * Operation scPublicV2ScpPostCreateParcelAsyncWithHttpInfo
     *
     * Create a parcel or parcels
     *
     * @param  string $sendcloudPartnerId If you are an official [Sendcloud Tech Partner](https://www.sendcloud.com/ecosystem/), send your unique Sendcloud Partner UUID as a request header for the system to recognize you.  The header is not required but if it is set, the system will check it. An unknown or invalid UUID will cause a 400 error. (optional)
     * @param  string $errors When making an API request, the errors query parameter can be used to determine the type of errors that should be included in the response. If &#x60;verbose&#x60; is specified, the response will only contain errors that Sendcloud has validated. These errors may include shipment details such as invalid addresses or missing postal codes. On the other hand, if &#x60;verbose-carrier&#x60; is specified, the response will include errors originating from the carriers side of the shipping process. These errors may result from technical or validation problems, such as connection failures or issues with the carrier&#x60;s systems, that prevent the shipment from being processed. More details are described on the page [Handling parcel errors](/docs/shipping/handling-parcel-errors). (optional)
     * @param  \Toppy\Sendcloud\Model\ScPublicV2ScpPostCreateParcelRequest $scPublicV2ScpPostCreateParcelRequest (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV2ScpPostCreateParcelAsyncWithHttpInfo($sendcloudPartnerId = null, $errors = null, $scPublicV2ScpPostCreateParcelRequest = null)
    {
        $returnType = \Toppy\Sendcloud\Model\ScPublicV2ScpPostCreateParcel200Response::class;
        $request = $this->scPublicV2ScpPostCreateParcelRequest($sendcloudPartnerId, $errors, $scPublicV2ScpPostCreateParcelRequest);

        return $this->httpAsyncClient->sendAsyncRequest($request)
            ->then(
                function ($response) use ($returnType) {
                    if ($returnType === '\SplFileObject') {
                        $content = $response->getBody(); //stream goes to serializer
                    } else {
                        $content = (string) $response->getBody();
                    }

                    return [
                        ObjectSerializer::deserialize($content, $returnType, []),
                        $response->getStatusCode(),
                        $response->getHeaders()
                    ];
                },
                function (HttpException $httpException) {
                    $response = $httpException->getResponse();
                    $statusCode = $response->getStatusCode();
                    throw new ApiException(
                        sprintf(
                            '[%d] Error connecting to the API (%s)',
                            $statusCode,
                            $httpException->getRequest()->getUri()
                        ),
                        $httpException->getRequest(),
                        $httpException->getResponse(),
                        $httpException
                    );
                }
            );
    }

    /**
     * Create request for operation 'scPublicV2ScpPostCreateParcel'
     *
     * @param  string $sendcloudPartnerId If you are an official [Sendcloud Tech Partner](https://www.sendcloud.com/ecosystem/), send your unique Sendcloud Partner UUID as a request header for the system to recognize you.  The header is not required but if it is set, the system will check it. An unknown or invalid UUID will cause a 400 error. (optional)
     * @param  string $errors When making an API request, the errors query parameter can be used to determine the type of errors that should be included in the response. If &#x60;verbose&#x60; is specified, the response will only contain errors that Sendcloud has validated. These errors may include shipment details such as invalid addresses or missing postal codes. On the other hand, if &#x60;verbose-carrier&#x60; is specified, the response will include errors originating from the carriers side of the shipping process. These errors may result from technical or validation problems, such as connection failures or issues with the carrier&#x60;s systems, that prevent the shipment from being processed. More details are described on the page [Handling parcel errors](/docs/shipping/handling-parcel-errors). (optional)
     * @param  \Toppy\Sendcloud\Model\ScPublicV2ScpPostCreateParcelRequest $scPublicV2ScpPostCreateParcelRequest (optional)
     *
     * @throws \InvalidArgumentException
     * @return RequestInterface
     */
    public function scPublicV2ScpPostCreateParcelRequest($sendcloudPartnerId = null, $errors = null, $scPublicV2ScpPostCreateParcelRequest = null)
    {

        $resourcePath = '/parcels';
        $formParams = [];
        $queryParams = [];
        $headerParams = [];
        $httpBody = null;
        $multipart = false;

        // query params
        if ($errors !== null) {
            if(is_array($errors)) {
                foreach($errors as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['errors'] = $errors;
            }
        }

        // header params
        if ($sendcloudPartnerId !== null) {
            $headerParams['Sendcloud-Partner-Id'] = ObjectSerializer::toHeaderValue($sendcloudPartnerId);
        }



        $headers = $this->headerSelector->selectHeaders(
            ['application/json'],
            'application/json',
            $multipart
        );

        // for model (json/xml)
        if (isset($scPublicV2ScpPostCreateParcelRequest)) {
            if ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode(ObjectSerializer::sanitizeForSerialization($scPublicV2ScpPostCreateParcelRequest));
            } else {
                $httpBody = $scPublicV2ScpPostCreateParcelRequest;
            }
        } elseif ($formParams !== []) {
            if ($multipart) {
                $multipartContents = [];
                foreach ($formParams as $formParamName => $formParamValue) {
                    $formParamValueItems = is_array($formParamValue) ? $formParamValue : [$formParamValue];
                    foreach ($formParamValueItems as $formParamValueItem) {
                        $multipartContents[] = [
                            'name' => $formParamName,
                            'contents' => $formParamValueItem
                        ];
                    }
                }

                // for HTTP post (form)
                $httpBody = new MultipartStream($multipartContents);

            } elseif ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode($formParams);

            } else {
                // for HTTP post (form)
                $httpBody = ObjectSerializer::buildQuery($formParams);
            }
        }

        // this endpoint requires HTTP basic authentication
        if (!empty($this->config->getUsername()) || !(empty($this->config->getPassword()))) {
            $headers['Authorization'] = 'Basic ' . base64_encode($this->config->getUsername() . ":" . $this->config->getPassword());
        }

        $defaultHeaders = [];
        if ($this->config->getUserAgent()) {
            $defaultHeaders['User-Agent'] = $this->config->getUserAgent();
        }

        $headers = array_merge(
            $defaultHeaders,
            $headerParams,
            $headers
        );

        $operationHost = $this->config->getHost();

        $uri = $this->createUri($operationHost, $resourcePath, $queryParams);

        return $this->createRequest('POST', $uri, $headers, $httpBody);
    }

    /**
     * Operation scPublicV2ScpPutUpdateAParcel
     *
     * Update a parcel
     *
     * @param  \Toppy\Sendcloud\Model\ScPublicV2ScpPutUpdateAParcelRequest $scPublicV2ScpPutUpdateAParcelRequest scPublicV2ScpPutUpdateAParcelRequest (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return \Toppy\Sendcloud\Model\ScPublicV2ScpPutUpdateAParcel200Response
     */
    public function scPublicV2ScpPutUpdateAParcel($scPublicV2ScpPutUpdateAParcelRequest = null)
    {
        [$response] = $this->scPublicV2ScpPutUpdateAParcelWithHttpInfo($scPublicV2ScpPutUpdateAParcelRequest);
        return $response;
    }

    /**
     * Operation scPublicV2ScpPutUpdateAParcelWithHttpInfo
     *
     * Update a parcel
     *
     * @param  \Toppy\Sendcloud\Model\ScPublicV2ScpPutUpdateAParcelRequest $scPublicV2ScpPutUpdateAParcelRequest (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return array of \Toppy\Sendcloud\Model\ScPublicV2ScpPutUpdateAParcel200Response, HTTP status code, HTTP response headers (array of strings)
     */
    public function scPublicV2ScpPutUpdateAParcelWithHttpInfo($scPublicV2ScpPutUpdateAParcelRequest = null)
    {
        $request = $this->scPublicV2ScpPutUpdateAParcelRequest($scPublicV2ScpPutUpdateAParcelRequest);

        try {
            try {
                $response = $this->httpClient->sendRequest($request);
            } catch (HttpException $e) {
                $response = $e->getResponse();
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $response->getStatusCode(),
                        (string) $request->getUri()
                    ),
                    $request,
                    $response,
                    $e
                );
            } catch (ClientExceptionInterface $e) {
                throw new ApiException(
                    sprintf('[%d] %s', $e->getCode(), $e->getMessage()),
                    $request,
                    null,
                    $e
                );
            }

            $statusCode = $response->getStatusCode();


            if ($statusCode === 200) {
                return $this->handleResponseWithDataType(
                    \Toppy\Sendcloud\Model\ScPublicV2ScpPutUpdateAParcel200Response::class,
                    $request,
                    $response,
                );
            }

            

            if ($statusCode < 200 || $statusCode > 299) {
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $statusCode,
                        (string) $request->getUri()
                    ),
                    $request,
                    $response
                );
            }

            return $this->handleResponseWithDataType(
                \Toppy\Sendcloud\Model\ScPublicV2ScpPutUpdateAParcel200Response::class,
                $request,
                $response,
            );
        } catch (ApiException $apiException) {
            if ($apiException->getCode() === 200) {
                $data = ObjectSerializer::deserialize(
                    $apiException->getResponseBody(),
                    \Toppy\Sendcloud\Model\ScPublicV2ScpPutUpdateAParcel200Response::class,
                    $apiException->getResponseHeaders()
                );
                $apiException->setResponseObject($data);
                throw $apiException;
            }
        

            throw $apiException;
        }
    }

    /**
     * Operation scPublicV2ScpPutUpdateAParcelAsync
     *
     * Update a parcel
     *
     * @param  \Toppy\Sendcloud\Model\ScPublicV2ScpPutUpdateAParcelRequest $scPublicV2ScpPutUpdateAParcelRequest (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV2ScpPutUpdateAParcelAsync($scPublicV2ScpPutUpdateAParcelRequest = null)
    {
        return $this->scPublicV2ScpPutUpdateAParcelAsyncWithHttpInfo($scPublicV2ScpPutUpdateAParcelRequest)
            ->then(
                function ($response) {
                    return $response[0];
                }
            );
    }

    /**
     * Operation scPublicV2ScpPutUpdateAParcelAsyncWithHttpInfo
     *
     * Update a parcel
     *
     * @param  \Toppy\Sendcloud\Model\ScPublicV2ScpPutUpdateAParcelRequest $scPublicV2ScpPutUpdateAParcelRequest (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV2ScpPutUpdateAParcelAsyncWithHttpInfo($scPublicV2ScpPutUpdateAParcelRequest = null)
    {
        $returnType = \Toppy\Sendcloud\Model\ScPublicV2ScpPutUpdateAParcel200Response::class;
        $request = $this->scPublicV2ScpPutUpdateAParcelRequest($scPublicV2ScpPutUpdateAParcelRequest);

        return $this->httpAsyncClient->sendAsyncRequest($request)
            ->then(
                function ($response) use ($returnType) {
                    if ($returnType === '\SplFileObject') {
                        $content = $response->getBody(); //stream goes to serializer
                    } else {
                        $content = (string) $response->getBody();
                    }

                    return [
                        ObjectSerializer::deserialize($content, $returnType, []),
                        $response->getStatusCode(),
                        $response->getHeaders()
                    ];
                },
                function (HttpException $httpException) {
                    $response = $httpException->getResponse();
                    $statusCode = $response->getStatusCode();
                    throw new ApiException(
                        sprintf(
                            '[%d] Error connecting to the API (%s)',
                            $statusCode,
                            $httpException->getRequest()->getUri()
                        ),
                        $httpException->getRequest(),
                        $httpException->getResponse(),
                        $httpException
                    );
                }
            );
    }

    /**
     * Create request for operation 'scPublicV2ScpPutUpdateAParcel'
     *
     * @param  \Toppy\Sendcloud\Model\ScPublicV2ScpPutUpdateAParcelRequest $scPublicV2ScpPutUpdateAParcelRequest (optional)
     *
     * @throws \InvalidArgumentException
     * @return RequestInterface
     */
    public function scPublicV2ScpPutUpdateAParcelRequest($scPublicV2ScpPutUpdateAParcelRequest = null)
    {

        $resourcePath = '/parcels';
        $formParams = [];
        $queryParams = [];
        $headerParams = [];
        $httpBody = null;
        $multipart = false;





        $headers = $this->headerSelector->selectHeaders(
            ['application/json'],
            'application/json',
            $multipart
        );

        // for model (json/xml)
        if (isset($scPublicV2ScpPutUpdateAParcelRequest)) {
            if ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode(ObjectSerializer::sanitizeForSerialization($scPublicV2ScpPutUpdateAParcelRequest));
            } else {
                $httpBody = $scPublicV2ScpPutUpdateAParcelRequest;
            }
        } elseif ($formParams !== []) {
            if ($multipart) {
                $multipartContents = [];
                foreach ($formParams as $formParamName => $formParamValue) {
                    $formParamValueItems = is_array($formParamValue) ? $formParamValue : [$formParamValue];
                    foreach ($formParamValueItems as $formParamValueItem) {
                        $multipartContents[] = [
                            'name' => $formParamName,
                            'contents' => $formParamValueItem
                        ];
                    }
                }

                // for HTTP post (form)
                $httpBody = new MultipartStream($multipartContents);

            } elseif ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode($formParams);

            } else {
                // for HTTP post (form)
                $httpBody = ObjectSerializer::buildQuery($formParams);
            }
        }

        // this endpoint requires HTTP basic authentication
        if (!empty($this->config->getUsername()) || !(empty($this->config->getPassword()))) {
            $headers['Authorization'] = 'Basic ' . base64_encode($this->config->getUsername() . ":" . $this->config->getPassword());
        }

        $defaultHeaders = [];
        if ($this->config->getUserAgent()) {
            $defaultHeaders['User-Agent'] = $this->config->getUserAgent();
        }

        $headers = array_merge(
            $defaultHeaders,
            $headerParams,
            $headers
        );

        $operationHost = $this->config->getHost();

        $uri = $this->createUri($operationHost, $resourcePath, $queryParams);

        return $this->createRequest('PUT', $uri, $headers, $httpBody);
    }


    /**
     * @param string|UriInterface $uri
     * @param string[] $headers
     * @param string|StreamInterface|null $body
     *
     */
    protected function createRequest(string $method, $uri, array $headers = [], $body = null): RequestInterface
    {
        if ($this->requestFactory instanceof RequestFactory) {
            return $this->requestFactory->createRequest(
                $method,
                $uri,
                $headers,
                $body
            );
        }

        if (is_string($body) && '' !== $body && null === $this->streamFactory) {
            throw new \RuntimeException('Cannot create request: A stream factory is required to create a request with a non-empty string body.');
        }

        $request = $this->requestFactory->createRequest($method, $uri);

        foreach ($headers as $key => $value) {
            $request = $request->withHeader($key, $value);
        }

        if (null !== $body && '' !== $body) {
            return $request->withBody(
                is_string($body) ? $this->streamFactory->createStream($body) : $body
            );
        }

        return $request;
    }

    private function createUri(
        string $operationHost,
        string $resourcePath,
        array $queryParams
    ): UriInterface {
        $parsedUrl = parse_url($operationHost);

        $host = $parsedUrl['host'] ?? null;
        $scheme = $parsedUrl['scheme'] ?? null;
        $basePath = $parsedUrl['path'] ?? null;
        $port = $parsedUrl['port'] ?? null;
        $user = $parsedUrl['user'] ?? null;
        $password = $parsedUrl['pass'] ?? null;

        $uri = $this->uriFactory->createUri($basePath . $resourcePath)
            ->withHost($host)
            ->withScheme($scheme)
            ->withPort($port)
            ->withQuery(ObjectSerializer::buildQuery($queryParams));

        if ($user) {
            return $uri->withUserInfo($user, $password);
        }

        return $uri;
    }

    /**
     * @return array<int, object|int|mixed[]|null>
     */
    private function handleResponseWithDataType(
        string $dataType,
        RequestInterface $request,
        ResponseInterface $response
    ): array {
        if ($dataType === '\SplFileObject') {
            $content = $response->getBody(); //stream goes to serializer
        } else {
            $content = (string) $response->getBody();
            if ($dataType !== 'string') {
                try {
                    $content = json_decode($content, false, 512, JSON_THROW_ON_ERROR);
                } catch (\JsonException $exception) {
                    throw new ApiException(
                        sprintf(
                            'Error JSON decoding server response (%s)',
                            $request->getUri()
                        ),
			$request,
                        $response,
                        $exception
                    );
                }
            }
        }

        return [
            ObjectSerializer::deserialize($content, $dataType, []),
            $response->getStatusCode(),
            $response->getHeaders()
        ];
    }
}
